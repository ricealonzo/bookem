<p style="color: green"><%= notice %></p>

<%= render @location %>

<% full_address = [@location.address, @location.city, @location.state, @location.postal_code].compact.join(", ") %>
<div class="mt-3">
  <h2>Map</h2>
  <iframe
    width="100%"
    height="360"
    style="border:0; border-radius: 12px;"
    loading="lazy"
    allowfullscreen
    referrerpolicy="no-referrer-when-downgrade"
    src="https://www.google.com/maps/embed/v1/place?key=<%= ENV.fetch("GOOGLE_MAPS_API_KEY", "") %>&q=<%= ERB::Util.url_encode(full_address) %>">
  </iframe>
</div>

<h2>Bookings Calendar</h2>

<%= month_calendar(events: @bookings, attribute: :started_at, end_attribute: :ended_at) do |date, bookings| %>
  <div class="day">
    <div class="fw-bold"><%= date.day %></div>

    <% bookings.each do |booking| %>
      <% started_at = booking.started_at.present? ? Time.zone.parse(booking.started_at.to_s) : nil %>
      <% ended_at = booking.ended_at.present? ? Time.zone.parse(booking.ended_at.to_s) : nil %>

      <div class="card-sm text-truncate" style="width: 4rem;">
        <div class="card-header">
          <div class="card-title">
            (<%= link_to booking.guest.email, booking %>)
          </div>
        </div>

        <div class="card-footer">
          <% if started_at && ended_at %>
            <p class="card-text"><%= started_at.strftime("%H:%M %p") %> to <%= ended_at.strftime("%H:%M %p") %></p>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>



<div>
  <%= link_to "Back to locations", locations_path %>

  <% if current_user&.id == @location.host_id %>
    <%= link_to "Edit this location", edit_location_path(@location) %> |
    <%= button_to "Destroy this location", @location, method: :delete %>
  <% end %>
</div>
